import{_ as a,c as s,f as t,o as e}from"./app-BsiRcwZM.js";const p={};function o(i,n){return e(),s("div",null,n[0]||(n[0]=[t(`<blockquote><p>昨天试验了 iOS 11 beta6 发现原有的 https 自建证书不能使用，可能是新版本要对 ATS 加强验证，之前一直说的要全面 https 估计在不久的将来就要来临，未接入的可能要像 Apple 说的不允许上架。所以把配置过程记录在此</p></blockquote><h2 id="要求" tabindex="-1"><a class="header-anchor" href="#要求"><span>要求</span></a></h2><p>启用 ATS 必须符合以下标准，不满足条件的 HTTPS 证书，ATS 都会拒绝链接：</p><ul><li>服务器所有的链接使用 TLS1.2 以上版本</li><li>HTTPS 证书必须使用 SHA 256 以上哈希算法签名</li><li>HTTPS 证书必须使用 RAS 2048 位或 ECC 356 位以上公钥算法</li><li>使用前向加密技术</li></ul><h2 id="afsecuritypolicy-相关的配置" tabindex="-1"><a class="header-anchor" href="#afsecuritypolicy-相关的配置"><span>AFSecurityPolicy 相关的配置</span></a></h2><ul><li><p>SSLPinningMode<br> SSLPinningMode 定义了 https 连接时，如何校验服务器端给予的证书</p><div class="language-objc line-numbers-mode" data-highlighter="prismjs" data-ext="objc" data-title="objc"><pre><code><span class="line"><span class="token keyword">typedef</span> <span class="token function">NS_ENUM</span><span class="token punctuation">(</span>NSUInteger<span class="token punctuation">,</span> AFSSLPinningMode<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">AFSSLPinningModeNone<span class="token punctuation">,</span></span>
<span class="line">AFSSLPinningModePublicKey<span class="token punctuation">,</span></span>
<span class="line">AFSSLPinningModeCertificate<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>AFSSLPinningModeNone: 代表客户端无条件地信任服务器端返回的证书。</p><p>AFSSLPinningModePublicKey: 代表客户端会将服务器端返回的证书与本地保存的证书中，PublicKey 的部分进行校验；如果正确，才继续进行。</p><p>AFSSLPinningModeCertificate: 代表客户端会将服务器端返回的证书和本地保存的证书中的所有内容，包括 PublicKey 和证书部分，全部进行校验；如果正确，才继续进行。</p></li><li><p>allowInvalidCertificates 是否支持自建证书默认 NO 改为 YES</p></li><li><p>validatesDomainName 是否进行域名验证 默认 YES 改为 NO</p></li></ul><h2 id="客户端配置" tabindex="-1"><a class="header-anchor" href="#客户端配置"><span>客户端配置</span></a></h2><ul><li><p>首先导入证书到项目<br><a href="https://cuntuku.com/image/4xc6p" target="_blank" rel="noopener noreferrer"><img src="https://storage1.cuntuku.com/2017/08/16/daoru.md.png" alt="daoru.md.png" loading="lazy"></a><br><a href="https://cuntuku.com/image/4xyN0" target="_blank" rel="noopener noreferrer"><img src="https://storage2.cuntuku.com/2017/08/16/phases.md.png" alt="phases.md.png" loading="lazy"></a></p></li><li><p>配置 info.plist 文件<br><a href="https://cuntuku.com/image/4xA2z" target="_blank" rel="noopener noreferrer"><img src="https://storage1.cuntuku.com/2017/08/16/infoplist.md.png" alt="infoplist.md.png" loading="lazy"></a></p></li><li><p>网络请求配置(AFN)</p></li></ul><div class="language-objc line-numbers-mode" data-highlighter="prismjs" data-ext="objc" data-title="objc"><pre><code><span class="line">NSString <span class="token operator">*</span>cerPath <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>NSBundle mainBundle<span class="token punctuation">]</span> pathForResource<span class="token punctuation">:</span><span class="token string">@&quot;UpopRsaCert&quot;</span> ofType<span class="token punctuation">:</span><span class="token string">@&quot;cer&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//证书的路径</span></span>
<span class="line">NSData <span class="token operator">*</span>certData <span class="token operator">=</span> <span class="token punctuation">[</span>NSData dataWithContentsOfFile<span class="token punctuation">:</span>cerPath<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">NSString <span class="token operator">*</span>cerPath2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>NSBundle mainBundle<span class="token punctuation">]</span> pathForResource<span class="token punctuation">:</span><span class="token string">@&quot;verify_sign_acp&quot;</span> ofType<span class="token punctuation">:</span><span class="token string">@&quot;cer&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//证书的路径</span></span>
<span class="line">NSData <span class="token operator">*</span>certData2 <span class="token operator">=</span> <span class="token punctuation">[</span>NSData dataWithContentsOfFile<span class="token punctuation">:</span>cerPath2<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">NSString <span class="token operator">*</span>cerPath3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>NSBundle mainBundle<span class="token punctuation">]</span> pathForResource<span class="token punctuation">:</span><span class="token string">@&quot;myWebsite&quot;</span> ofType<span class="token punctuation">:</span><span class="token string">@&quot;cer&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//证书的路径</span></span>
<span class="line">NSData <span class="token operator">*</span>certData3 <span class="token operator">=</span> <span class="token punctuation">[</span>NSData dataWithContentsOfFile<span class="token punctuation">:</span>cerPath3<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">NSSet <span class="token operator">*</span>cerArray <span class="token operator">=</span> <span class="token punctuation">[</span>NSSet setWithObjects<span class="token punctuation">:</span>certData<span class="token punctuation">,</span>certData2<span class="token punctuation">,</span>certData3<span class="token punctuation">,</span> nil<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">securityPolicy<span class="token punctuation">.</span>pinnedCertificates <span class="token operator">=</span> cerArray<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">[</span>httpManager setSecurityPolicy<span class="token punctuation">:</span>securityPolicy<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,9)]))}const l=a(p,[["render",o],["__file","配置https.html.vue"]]),u=JSON.parse('{"path":"/tutorial/iPhone/tool/%E9%85%8D%E7%BD%AEhttps.html","title":"iOS 配置https","lang":"zh-CN","frontmatter":{"title":"iOS 配置https","date":"2017-08-16T00:00:00.000Z","category":["iOS"],"tag":["iOS"],"description":"昨天试验了 iOS 11 beta6 发现原有的 https 自建证书不能使用，可能是新版本要对 ATS 加强验证，之前一直说的要全面 https 估计在不久的将来就要来临，未接入的可能要像 Apple 说的不允许上架。所以把配置过程记录在此 要求 启用 ATS 必须符合以下标准，不满足条件的 HTTPS 证书，ATS 都会拒绝链接： 服务器所有的链接...","head":[["meta",{"property":"og:url","content":"https://www.viptv.work/tutorial/iPhone/tool/%E9%85%8D%E7%BD%AEhttps.html"}],["meta",{"property":"og:site_name","content":"VIPTV - 工作室"}],["meta",{"property":"og:title","content":"iOS 配置https"}],["meta",{"property":"og:description","content":"昨天试验了 iOS 11 beta6 发现原有的 https 自建证书不能使用，可能是新版本要对 ATS 加强验证，之前一直说的要全面 https 估计在不久的将来就要来临，未接入的可能要像 Apple 说的不允许上架。所以把配置过程记录在此 要求 启用 ATS 必须符合以下标准，不满足条件的 HTTPS 证书，ATS 都会拒绝链接： 服务器所有的链接..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://storage1.cuntuku.com/2017/08/16/daoru.md.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-11-26T08:34:49.000Z"}],["meta",{"property":"article:tag","content":"iOS"}],["meta",{"property":"article:published_time","content":"2017-08-16T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-11-26T08:34:49.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"iOS 配置https\\",\\"image\\":[\\"https://storage1.cuntuku.com/2017/08/16/daoru.md.png\\",\\"https://storage2.cuntuku.com/2017/08/16/phases.md.png\\",\\"https://storage1.cuntuku.com/2017/08/16/infoplist.md.png\\"],\\"datePublished\\":\\"2017-08-16T00:00:00.000Z\\",\\"dateModified\\":\\"2024-11-26T08:34:49.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr.Hefung\\",\\"url\\":\\"/about/us\\"}]}"]]},"headers":[{"level":2,"title":"要求","slug":"要求","link":"#要求","children":[]},{"level":2,"title":"AFSecurityPolicy 相关的配置","slug":"afsecuritypolicy-相关的配置","link":"#afsecuritypolicy-相关的配置","children":[]},{"level":2,"title":"客户端配置","slug":"客户端配置","link":"#客户端配置","children":[]}],"git":{"createdTime":1732610089000,"updatedTime":1732610089000,"contributors":[{"name":"github-actions[bot]","email":"28900094+github-actions[bot]@users.noreply.github.com","commits":1}]},"readingTime":{"minutes":1.63,"words":488},"filePathRelative":"tutorial/iPhone/tool/配置https.md","localizedDate":"2017年8月16日","excerpt":"","autoDesc":true}');export{l as comp,u as data};
