import{_ as s,c as a,f as p,o as t}from"./app-XeCtrKsd.js";const e={};function o(c,n){return t(),a("div",null,n[0]||(n[0]=[p(`<figure><img src="https://zero-space.s3.amazonaws.com/photos/bf30834c-a9de-41f4-9f39-4f44c2f2ff13x840.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><blockquote><p>由于最近公司在做图片相册选择上传的功能，对于图片的压缩算法这里我借鉴了 ochina 的 ios 端 App。其中有涉及到图片压缩的算法，这里贴出来留待后用;</p></blockquote><h3 id="gacompressionpichandle-h" tabindex="-1"><a class="header-anchor" href="#gacompressionpichandle-h"><span>GACompressionPicHandle.h</span></a></h3><div class="language-objc line-numbers-mode" data-highlighter="prismjs" data-ext="objc" data-title="objc"><pre><code><span class="line">    	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token expression"><span class="token operator">&lt;</span>Foundation<span class="token operator">/</span>Foundation<span class="token punctuation">.</span>h<span class="token operator">&gt;</span></span></span></span>
<span class="line">    	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token expression"><span class="token operator">&lt;</span>UIKit<span class="token operator">/</span>UIKit<span class="token punctuation">.</span>h<span class="token operator">&gt;</span></span></span></span>
<span class="line">    	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token expression"><span class="token operator">&lt;</span>CoreGraphics<span class="token operator">/</span>CoreGraphics<span class="token punctuation">.</span>h<span class="token operator">&gt;</span></span></span></span>
<span class="line"></span>
<span class="line">    	<span class="token keyword">@class</span> GACompressionPicHandle<span class="token punctuation">;</span></span>
<span class="line">    	<span class="token keyword">@protocol</span> GACompressionPicHandleDelegate <span class="token operator">&lt;</span>NSObject<span class="token operator">&gt;</span></span>
<span class="line">    	<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>CompressionPicHandle<span class="token punctuation">:</span><span class="token punctuation">(</span>GACompressionPicHandle<span class="token operator">*</span> <span class="token punctuation">)</span>handle</span>
<span class="line">      			CompressionFailureInfo<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString<span class="token operator">*</span> <span class="token punctuation">)</span>info<span class="token punctuation">;</span></span>
<span class="line">      	<span class="token keyword">@end</span></span>
<span class="line"></span>
<span class="line">      	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CompressionMax_W</span> <span class="token expression"><span class="token number">1224</span></span></span></span>
<span class="line">      	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CompressionMax_Size</span> <span class="token expression"><span class="token number">300</span> <span class="token operator">*</span> <span class="token number">1024</span></span></span></span>
<span class="line">      	<span class="token comment">/** OSChina 后台限制上传图片的大小*/</span></span>
<span class="line">      	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">stand_size</span> <span class="token expression"><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">800</span></span></span></span>
<span class="line">      	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">min_compressionRatio</span> <span class="token expression"><span class="token number">0.3</span></span></span></span>
<span class="line"></span>
<span class="line">      	<span class="token keyword">@interface</span> GACompressionPicHandle <span class="token punctuation">:</span> NSObject</span>
<span class="line"></span>
<span class="line">      	<span class="token operator">+</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>shareCompressionPicHandle<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">@property</span><span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span>weak<span class="token punctuation">)</span>id<span class="token operator">&lt;</span>GACompressionPicHandleDelegate<span class="token operator">&gt;</span> delegate<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    	<span class="token comment">/** 分辨率越小反而越占用时间 建议分辨率高的图片使用*/</span></span>
<span class="line">    <span class="token operator">-</span> <span class="token punctuation">(</span>NSData<span class="token operator">*</span> <span class="token punctuation">)</span>scaleToSize<span class="token punctuation">:</span><span class="token punctuation">(</span>CGSize<span class="token punctuation">)</span>size</span>
<span class="line">                   image<span class="token punctuation">:</span><span class="token punctuation">(</span>UIImage<span class="token operator">*</span> <span class="token punctuation">)</span>picture<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">         <span class="token comment">/** 受到宽高比例问题 越接近正方形所用的时间越小 */</span></span>
<span class="line">    <span class="token operator">-</span> <span class="token punctuation">(</span>NSData <span class="token operator">*</span><span class="token punctuation">)</span>imageByScalingAndCroppingForSize<span class="token punctuation">:</span><span class="token punctuation">(</span>	CGSize<span class="token punctuation">)</span>targetSize image<span class="token punctuation">:</span><span class="token punctuation">(</span>UIImage <span class="token operator">*</span><span class="token punctuation">)</span>image<span class="token punctuation">;</span></span>
<span class="line">    	<span class="token keyword">@end</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="gacompressionpichandle-m" tabindex="-1"><a class="header-anchor" href="#gacompressionpichandle-m"><span>GACompressionPicHandle.m</span></a></h3><div class="language-objc line-numbers-mode" data-highlighter="prismjs" data-ext="objc" data-title="objc"><pre><code><span class="line"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token string">&quot;GACompressionPicHandle.h&quot;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">@implementation</span> GACompressionPicHandle</span>
<span class="line"></span>
<span class="line"><span class="token keyword">static</span> GACompressioinPicHandle<span class="token operator">*</span>_shareCompressionPicHandle<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">+</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>shareCompressionPicHandle<span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">static</span> dispatch_once_t onceToken<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">dispatch_once</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>onceToken<span class="token punctuation">,</span> <span class="token operator">^</span><span class="token punctuation">{</span></span>
<span class="line">        _shareCompressionPicHandle <span class="token operator">=</span> 					<span class="token punctuation">[</span><span class="token punctuation">[</span>GACompressionPicHandle alloc<span class="token punctuation">]</span>init<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> _shareCompressionPicHandle<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token operator">-</span> <span class="token punctuation">(</span>NSData<span class="token operator">*</span> <span class="token punctuation">)</span>scaleToSize<span class="token punctuation">:</span><span class="token punctuation">(</span>CGSize<span class="token punctuation">)</span>sizeimage<span class="token punctuation">:</span><span class="token punctuation">(</span>UIImage<span class="token operator">*</span> <span class="token punctuation">)</span>picture <span class="token punctuation">{</span></span>
<span class="line">    CGFloat width <span class="token operator">=</span> <span class="token function">CGImageGetWidth</span><span class="token punctuation">(</span>picture<span class="token punctuation">.</span>CGImage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    CGFloat height <span class="token operator">=</span> <span class="token function">CGImageGetHeight</span><span class="token punctuation">(</span>picture<span class="token punctuation">.</span>CGImage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">float</span> verticalRadio <span class="token operator">=</span> size<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">1.0</span> <span class="token operator">/</span> height<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">float</span> horizontalRadio <span class="token operator">=</span> size<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token number">1.0</span> <span class="token operator">/</span> width<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">float</span> radio <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>verticalRadio <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> horizontalRadio <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    radio <span class="token operator">=</span> verticalRadio <span class="token operator">&gt;</span> horizontalRadio <span class="token operator">?</span> horizontalRadio <span class="token punctuation">:</span> verticalRadio<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">    radio <span class="token operator">=</span> verticalRadio <span class="token operator">&lt;</span> horizontalRadio <span class="token operator">?</span> verticalRadio <span class="token punctuation">:</span> horizontalRadio<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    width <span class="token operator">=</span> width <span class="token operator">*</span> radio<span class="token punctuation">;</span></span>
<span class="line">    height <span class="token operator">=</span> height <span class="token operator">*</span> radio<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">int</span> xPos <span class="token operator">=</span> <span class="token punctuation">(</span>size<span class="token punctuation">.</span>width <span class="token operator">-</span> width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">int</span> yPos <span class="token operator">=</span> <span class="token punctuation">(</span>size<span class="token punctuation">.</span>height <span class="token operator">-</span> height<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">UIGraphicsBeginImageContext</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">[</span>picture drawInRect<span class="token punctuation">:</span><span class="token function">CGRectMake</span><span class="token punctuation">(</span>xPos<span class="token punctuation">,</span> yPos<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    UIImage<span class="token operator">*</span> scaledImage <span class="token operator">=</span> <span class="token function">UIGraphicsGetImageFromCurrentImageContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">UIGraphicsEndImageContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    NSData<span class="token operator">*</span> scaledImageData <span class="token operator">=</span> <span class="token function">UIImageJPEGRepresentation</span><span class="token punctuation">(</span>scaledImage<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    CGFloat compressionRatio <span class="token operator">=</span> <span class="token number">0.9f</span><span class="token punctuation">;</span></span>
<span class="line">    NSData<span class="token operator">*</span> tagerImageData <span class="token operator">=</span> scaledImageData<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;tagerImageData.length : %lu&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">)</span>tagerImageData<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span>tagerImageData<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> stand_size <span class="token operator">&amp;&amp;</span> compressionRatio <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>compressionRatio <span class="token operator">&lt;</span> min_compressionRatio<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>_delegate respondsToSelector<span class="token punctuation">:</span><span class="token keyword">@selector</span><span class="token punctuation">(</span>CompressionPicHandle<span class="token punctuation">:</span>CompressionFailureInfo<span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token punctuation">[</span>_delegate CompressionPicHandle<span class="token punctuation">:</span><span class="token keyword">self</span> CompressionFailureInfo<span class="token punctuation">:</span><span class="token string">@&quot;图片过大&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token operator">@</span>autoreleasepool <span class="token punctuation">{</span></span>
<span class="line">            NSData<span class="token operator">*</span> newCompressionData <span class="token operator">=</span> <span class="token function">UIImageJPEGRepresentation</span><span class="token punctuation">(</span>scaledImage<span class="token punctuation">,</span> compressionRatio<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            tagerImageData <span class="token operator">=</span> newCompressionData<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        compressionRatio <span class="token operator">=</span> compressionRatio <span class="token operator">-</span> <span class="token number">0.12</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;tagerImageData.length : %lu , compressionRatio : %lf&quot;</span><span class="token punctuation">,</span>tagerImageData<span class="token punctuation">.</span>length<span class="token punctuation">,</span>compressionRatio<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;compressionRatio : %lf&quot;</span><span class="token punctuation">,</span>compressionRatio<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> tagerImageData<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token operator">-</span> <span class="token punctuation">(</span>NSData <span class="token operator">*</span><span class="token punctuation">)</span>imageByScalingAndCroppingForSize<span class="token punctuation">:</span><span class="token punctuation">(</span>CGSize<span class="token punctuation">)</span>targetSize image<span class="token punctuation">:</span><span class="token punctuation">(</span>UIImage <span class="token operator">*</span><span class="token punctuation">)</span>image <span class="token punctuation">{</span></span>
<span class="line">    UIImage <span class="token operator">*</span>sourceImage <span class="token operator">=</span> image<span class="token punctuation">;</span></span>
<span class="line">    UIImage <span class="token operator">*</span>newImage <span class="token operator">=</span> nil<span class="token punctuation">;</span></span>
<span class="line">    CGSize imageSize <span class="token operator">=</span> sourceImage<span class="token punctuation">.</span>size<span class="token punctuation">;</span></span>
<span class="line">    CGFloat width <span class="token operator">=</span> imageSize<span class="token punctuation">.</span>width<span class="token punctuation">;</span></span>
<span class="line">    CGFloat height <span class="token operator">=</span> imageSize<span class="token punctuation">.</span>height<span class="token punctuation">;</span></span>
<span class="line">    CGFloat targetWidth <span class="token operator">=</span> targetSize<span class="token punctuation">.</span>width<span class="token punctuation">;</span></span>
<span class="line">    CGFloat targetHeight <span class="token operator">=</span> targetSize<span class="token punctuation">.</span>height<span class="token punctuation">;</span></span>
<span class="line">    CGFloat scaleFactor <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span></span>
<span class="line">    CGFloat scaledWidth <span class="token operator">=</span> targetWidth<span class="token punctuation">;</span></span>
<span class="line">    CGFloat scaledHeight <span class="token operator">=</span> targetHeight<span class="token punctuation">;</span></span>
<span class="line">    CGPoint thumbnailPoint <span class="token operator">=</span> <span class="token function">CGPointMake</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">CGSizeEqualToSize</span><span class="token punctuation">(</span>imageSize<span class="token punctuation">,</span> targetSize<span class="token punctuation">)</span> <span class="token operator">==</span> NO<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    CGFloat widthFactor <span class="token operator">=</span> targetWidth <span class="token operator">/</span> width<span class="token punctuation">;</span></span>
<span class="line">    CGFloat heightFactor <span class="token operator">=</span> targetHeight <span class="token operator">/</span> height<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>widthFactor <span class="token operator">&gt;</span> heightFactor<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    scaleFactor <span class="token operator">=</span> widthFactor<span class="token punctuation">;</span> <span class="token comment">// scale to fit height</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">        scaleFactor <span class="token operator">=</span> heightFactor<span class="token punctuation">;</span> <span class="token comment">// scale to fit width</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    scaledWidth<span class="token operator">=</span> width <span class="token operator">*</span> scaleFactor<span class="token punctuation">;</span></span>
<span class="line">    scaledHeight <span class="token operator">=</span> height <span class="token operator">*</span> scaleFactor<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>widthFactor <span class="token operator">&gt;</span> heightFactor<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        thumbnailPoint<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token punctuation">(</span>targetHeight <span class="token operator">-</span> scaledHeight<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>widthFactor <span class="token operator">&lt;</span> heightFactor<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        thumbnailPoint<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span>targetWidth <span class="token operator">-</span> scaledWidth<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">UIGraphicsBeginImageContext</span><span class="token punctuation">(</span>targetSize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this will crop</span></span>
<span class="line">    CGRect thumbnailRect <span class="token operator">=</span> CGRectZero<span class="token punctuation">;</span></span>
<span class="line">    thumbnailRect<span class="token punctuation">.</span>origin <span class="token operator">=</span> thumbnailPoint<span class="token punctuation">;</span></span>
<span class="line">    thumbnailRect<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token operator">=</span> scaledWidth<span class="token punctuation">;</span></span>
<span class="line">    thumbnailRect<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height <span class="token operator">=</span> scaledHeight<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">[</span>sourceImage drawInRect<span class="token punctuation">:</span>thumbnailRect<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    newImage <span class="token operator">=</span> <span class="token function">UIGraphicsGetImageFromCurrentImageContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span><span class="token punctuation">(</span>newImage <span class="token operator">==</span> nil<span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">UIGraphicsEndImageContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    NSData<span class="token operator">*</span> scaledImageData <span class="token operator">=</span> <span class="token function">UIImageJPEGRepresentation</span><span class="token punctuation">(</span>newImage<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    CGFloat compressionRatio <span class="token operator">=</span> <span class="token number">0.9f</span><span class="token punctuation">;</span></span>
<span class="line">    NSData<span class="token operator">*</span> tagerImageData <span class="token operator">=</span> scaledImageData<span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;tagerImageData.length : %lu&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">)</span>tagerImageData<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span>tagerImageData<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> stand_size <span class="token operator">&amp;&amp;</span> compressionRatio <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>compressionRatio <span class="token operator">&lt;</span> min_compressionRatio<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>_delegate respondsToSelector<span class="token punctuation">:</span><span class="token keyword">@selector</span><span class="token punctuation">(</span>CompressionPicHandle<span class="token punctuation">:</span>CompressionFailureInfo<span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token punctuation">[</span>_delegate CompressionPicHandle<span class="token punctuation">:</span><span class="token keyword">self</span> CompressionFailureInfo<span class="token punctuation">:</span><span class="token string">@&quot;图片过大&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token operator">@</span>autoreleasepool <span class="token punctuation">{</span></span>
<span class="line">            NSData<span class="token operator">*</span> newCompressionData <span class="token operator">=</span> <span class="token function">UIImageJPEGRepresentation</span><span class="token punctuation">(</span>newImage<span class="token punctuation">,</span> compressionRatio<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            tagerImageData <span class="token operator">=</span> newCompressionData<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        compressionRatio <span class="token operator">=</span> compressionRatio <span class="token operator">-</span> <span class="token number">0.12</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;tagerImageData.length : %lu , compressionRatio : %lf&quot;</span><span class="token punctuation">,</span>tagerImageData<span class="token punctuation">.</span>length<span class="token punctuation">,</span>compressionRatio<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;compressionRatio : %lf&quot;</span><span class="token punctuation">,</span>compressionRatio<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> tagerImageData<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6)]))}const l=s(e,[["render",o],["__file","图片上传压缩算法.html.vue"]]),u=JSON.parse('{"path":"/tutorial/iPhone/tool/%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E5%8E%8B%E7%BC%A9%E7%AE%97%E6%B3%95.html","title":"iOS - Image compression algorithm","lang":"zh-CN","frontmatter":{"title":"iOS - Image compression algorithm","date":"2016-12-30T16:09:45.000Z","category":["iOS"],"tag":["iOS","工具集","算法"],"description":"由于最近公司在做图片相册选择上传的功能，对于图片的压缩算法这里我借鉴了 ochina 的 ios 端 App。其中有涉及到图片压缩的算法，这里贴出来留待后用; GACompressionPicHandle.h GACompressionPicHandle.m","head":[["meta",{"property":"og:url","content":"https://www.viptv.work/tutorial/iPhone/tool/%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E5%8E%8B%E7%BC%A9%E7%AE%97%E6%B3%95.html"}],["meta",{"property":"og:site_name","content":"VIPTV - 工作室"}],["meta",{"property":"og:title","content":"iOS - Image compression algorithm"}],["meta",{"property":"og:description","content":"由于最近公司在做图片相册选择上传的功能，对于图片的压缩算法这里我借鉴了 ochina 的 ios 端 App。其中有涉及到图片压缩的算法，这里贴出来留待后用; GACompressionPicHandle.h GACompressionPicHandle.m"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://zero-space.s3.amazonaws.com/photos/bf30834c-a9de-41f4-9f39-4f44c2f2ff13x840.jpg"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-11-25T21:06:31.000Z"}],["meta",{"property":"article:tag","content":"iOS"}],["meta",{"property":"article:tag","content":"工具集"}],["meta",{"property":"article:tag","content":"算法"}],["meta",{"property":"article:published_time","content":"2016-12-30T16:09:45.000Z"}],["meta",{"property":"article:modified_time","content":"2024-11-25T21:06:31.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"iOS - Image compression algorithm\\",\\"image\\":[\\"https://zero-space.s3.amazonaws.com/photos/bf30834c-a9de-41f4-9f39-4f44c2f2ff13x840.jpg\\"],\\"datePublished\\":\\"2016-12-30T16:09:45.000Z\\",\\"dateModified\\":\\"2024-11-25T21:06:31.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr.Hefung\\",\\"url\\":\\"/about/us\\"}]}"]]},"headers":[{"level":3,"title":"GACompressionPicHandle.h","slug":"gacompressionpichandle-h","link":"#gacompressionpichandle-h","children":[]},{"level":3,"title":"GACompressionPicHandle.m","slug":"gacompressionpichandle-m","link":"#gacompressionpichandle-m","children":[]}],"git":{"createdTime":1732568791000,"updatedTime":1732568791000,"contributors":[{"name":"github-actions[bot]","email":"28900094+github-actions[bot]@users.noreply.github.com","commits":1}]},"readingTime":{"minutes":1.88,"words":564},"filePathRelative":"tutorial/iPhone/tool/图片上传压缩算法.md","localizedDate":"2016年12月31日","excerpt":"","autoDesc":true}');export{l as comp,u as data};
